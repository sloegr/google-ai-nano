<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chrome Built-in AI Translator</title>
  </head>
  <body>
    <div class="container">
      <h1>Chrome Built-in AI Translator</h1>

      <div id="status" class="status" style="display: none"></div>

      <div class="form-group">
        <label for="sourceLanguage">Source Language:</label>
        <select id="sourceLanguage">
          <option value="en">English</option>
          <option value="es">Spanish</option>
          <option value="fr">French</option>
          <option value="de">German</option>
          <option value="it">Italian</option>
          <option value="ja">Japanese</option>
          <option value="zh">Chinese (Simplified)</option>
          <option value="zh-Hant">Chinese (Traditional)</option>
          <option value="ko">Korean</option>
          <option value="pt">Portuguese</option>
          <option value="hi">Hindi</option>
        </select>
      </div>

      <div class="form-group">
        <label for="targetLanguage">Target Language:</label>
        <select id="targetLanguage">
          <option value="es">Spanish</option>
          <option value="en">English</option>
          <option value="fr">French</option>
          <option value="de">German</option>
          <option value="it">Italian</option>
          <option value="ja">Japanese</option>
          <option value="zh">Chinese (Simplified)</option>
          <option value="zh-Hant">Chinese (Traditional)</option>
          <option value="ko">Korean</option>
          <option value="pt">Portuguese</option>
          <option value="hi">Hindi</option>
        </select>
      </div>

      <div class="form-group">
        <label for="inputText">Text to Translate:</label>
        <textarea
          id="inputText"
          rows="20"
          cols="120"
          placeholder="Enter text to translate..."
        >
Hello! How are you today? I hope you're having a wonderful day.</textarea
        >
      </div>

      <button id="translateBtn" onclick="translateText()">Translate</button>

      <div id="result" class="result" style="display: none">
        <h3>Translation:</h3>
        <p id="translatedText"></p>
      </div>
    </div>

    <script>
      // Check if Translator API is available
      async function checkAvailability() {
        const statusDiv = document.getElementById("status");

        // Use the official detection method from documentation
        if (!("Translator" in self)) {
          statusDiv.textContent =
            "❌ Translator API is not available. Please use Chrome 131+ and enable chrome://flags/#translation-api";
          statusDiv.className = "status error";
          statusDiv.style.display = "block";
          document.getElementById("translateBtn").disabled = true;
          return false;
        }

        statusDiv.textContent = "✓ Translator API is available!";
        statusDiv.className = "status success";
        statusDiv.style.display = "block";
        return true;
      }

      async function translateText() {
        const sourceLanguage = document.getElementById("sourceLanguage").value;
        const targetLanguage = document.getElementById("targetLanguage").value;
        const inputText = document.getElementById("inputText").value;
        const resultDiv = document.getElementById("result");
        const translatedTextP = document.getElementById("translatedText");
        const translateBtn = document.getElementById("translateBtn");

        if (!inputText.trim()) {
          alert("Please enter text to translate");
          return;
        }

        if (sourceLanguage === targetLanguage) {
          alert("Please select different source and target languages");
          return;
        }

        try {
          // Disable button and show loading
          translateBtn.disabled = true;
          resultDiv.style.display = "block";
          translatedTextP.innerHTML =
            '<span class="loading">Translating...</span>';

          // Check language pair availability using official API
          const capabilities = await Translator.availability({
            sourceLanguage: sourceLanguage,
            targetLanguage: targetLanguage,
          });

          if (capabilities === "no") {
            throw new Error(
              `Translation from ${sourceLanguage} to ${targetLanguage} is not supported`
            );
          }

          if (capabilities === "after-download") {
            translatedTextP.innerHTML =
              '<span class="loading">Downloading language model... This may take a moment.</span>';
          }

          // Create translator with download progress monitoring
          const translator = await Translator.create({
            sourceLanguage: sourceLanguage,
            targetLanguage: targetLanguage,
            monitor(m) {
              m.addEventListener("downloadprogress", (e) => {
                const percent = Math.round(e.loaded * 100);
                translatedTextP.innerHTML = `<span class="loading">Downloading model: ${percent}%</span>`;
              });
            },
          });

          // Start timer
          const startTime = performance.now();

          // Perform translation
          const result = await translator.translate(inputText);

          // End timer and calculate duration
          const endTime = performance.now();
          const duration = Math.round(endTime - startTime);

          // Display result
          translatedTextP.textContent = result;

          // Add response time
          const timeDiv = document.createElement("div");
          timeDiv.className = "response-time";
          timeDiv.textContent = `(Responded in ${duration}ms)`;
          translatedTextP.appendChild(timeDiv);

          // Cleanup
          translator.destroy();
        } catch (error) {
          console.error("Translation error:", error);
          translatedTextP.innerHTML = `<span style="color: #c33;">Error: ${error.message}</span>`;
        } finally {
          translateBtn.disabled = false;
        }
      }

      // Check availability on page load
      window.addEventListener("load", checkAvailability);
    </script>
  </body>
</html>
